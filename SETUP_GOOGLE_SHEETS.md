# Google Sheets API ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—æ‰‹é †

ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã§ã¯ã€Google Sheets APIã‚’ä½¿ç”¨ã™ã‚‹ãŸã‚ã®è¨­å®šæ–¹æ³•ã‚’èª¬æ˜ã—ã¾ã™ã€‚

## ğŸ¯ å¿…è¦ãªã‚‚ã®

- Googleã‚¢ã‚«ã‚¦ãƒ³ãƒˆ
- Google Cloud Platformã‚¢ã‚«ã‚¦ãƒ³ãƒˆï¼ˆç„¡æ–™ï¼‰

## ğŸ“‹ ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—æ‰‹é †

### Step 1: Google Cloud Platformãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆ

1. **Google Cloud Console**ã«ã‚¢ã‚¯ã‚»ã‚¹
   - https://console.cloud.google.com/

2. **æ–°ã—ã„ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆ**
   - ç”»é¢ä¸Šéƒ¨ã®ã€Œãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’é¸æŠã€â†’ã€Œæ–°ã—ã„ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã€
   - ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå: `kickstarter-analyzer`ï¼ˆä»»æ„ï¼‰
   - ã€Œä½œæˆã€ã‚’ã‚¯ãƒªãƒƒã‚¯

3. **ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’é¸æŠ**
   - ä½œæˆã—ãŸãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãŒé¸æŠã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèª

### Step 2: Google Sheets APIã‚’æœ‰åŠ¹åŒ–

1. **APIã¨ã‚µãƒ¼ãƒ“ã‚¹ > ãƒ©ã‚¤ãƒ–ãƒ©ãƒª**ã«ã‚¢ã‚¯ã‚»ã‚¹
   - å·¦ãƒ¡ãƒ‹ãƒ¥ãƒ¼ > ã€ŒAPIã¨ã‚µãƒ¼ãƒ“ã‚¹ã€ > ã€Œãƒ©ã‚¤ãƒ–ãƒ©ãƒªã€

2. **Google Sheets APIã‚’æ¤œç´¢**
   - æ¤œç´¢ãƒœãƒƒã‚¯ã‚¹ã«ã€ŒGoogle Sheets APIã€ã¨å…¥åŠ›

3. **Google Sheets APIã‚’æœ‰åŠ¹åŒ–**
   - ã€ŒGoogle Sheets APIã€ã‚’ã‚¯ãƒªãƒƒã‚¯
   - ã€Œæœ‰åŠ¹ã«ã™ã‚‹ã€ã‚’ã‚¯ãƒªãƒƒã‚¯

### Step 3: OAuth 2.0ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆIDã‚’ä½œæˆ

1. **èªè¨¼æƒ…å ±ãƒšãƒ¼ã‚¸ã«ã‚¢ã‚¯ã‚»ã‚¹**
   - å·¦ãƒ¡ãƒ‹ãƒ¥ãƒ¼ > ã€ŒAPIã¨ã‚µãƒ¼ãƒ“ã‚¹ã€ > ã€Œèªè¨¼æƒ…å ±ã€

2. **OAuthåŒæ„ç”»é¢ã‚’è¨­å®š**ï¼ˆåˆå›ã®ã¿ï¼‰
   - ã€ŒOAuthåŒæ„ç”»é¢ã€ã‚¿ãƒ–ã‚’ã‚¯ãƒªãƒƒã‚¯
   - User Type: ã€Œå¤–éƒ¨ã€ã‚’é¸æŠ â†’ ã€Œä½œæˆã€
   - ã‚¢ãƒ—ãƒªå: `Kickstarter Market Analyzer`ï¼ˆä»»æ„ï¼‰
   - ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚µãƒãƒ¼ãƒˆãƒ¡ãƒ¼ãƒ«: è‡ªåˆ†ã®Gmailã‚¢ãƒ‰ãƒ¬ã‚¹
   - ãƒ‡ãƒ™ãƒ­ãƒƒãƒ‘ãƒ¼ã®é€£çµ¡å…ˆæƒ…å ±: è‡ªåˆ†ã®Gmailã‚¢ãƒ‰ãƒ¬ã‚¹
   - ã€Œä¿å­˜ã—ã¦æ¬¡ã¸ã€

3. **ã‚¹ã‚³ãƒ¼ãƒ—ã‚’è¿½åŠ **ï¼ˆåˆå›ã®ã¿ï¼‰
   - ã€Œã‚¹ã‚³ãƒ¼ãƒ—ã‚’è¿½åŠ ã¾ãŸã¯å‰Šé™¤ã€ã‚’ã‚¯ãƒªãƒƒã‚¯
   - æ¤œç´¢: `Google Sheets API`
   - `.../auth/spreadsheets` ã«ãƒã‚§ãƒƒã‚¯
   - ã€Œæ›´æ–°ã€ â†’ ã€Œä¿å­˜ã—ã¦æ¬¡ã¸ã€

4. **ãƒ†ã‚¹ãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’è¿½åŠ **ï¼ˆåˆå›ã®ã¿ï¼‰
   - ã€Œãƒ†ã‚¹ãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼ã€ã‚¿ãƒ–
   - ã€Œ+ ADD USERSã€ã‚’ã‚¯ãƒªãƒƒã‚¯
   - è‡ªåˆ†ã®Gmailã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å…¥åŠ›
   - ã€Œä¿å­˜ã—ã¦æ¬¡ã¸ã€

5. **OAuth 2.0ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆIDã‚’ä½œæˆ**
   - ã€Œèªè¨¼æƒ…å ±ã€ã‚¿ãƒ–ã«æˆ»ã‚‹
   - ã€Œ+ èªè¨¼æƒ…å ±ã‚’ä½œæˆã€ > ã€ŒOAuth ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ IDã€
   - ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ç¨®é¡: ã€Œãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ã‚¢ãƒ—ãƒªã€
   - åå‰: `Kickstarter Analyzer Desktop`ï¼ˆä»»æ„ï¼‰
   - ã€Œä½œæˆã€ã‚’ã‚¯ãƒªãƒƒã‚¯

6. **credentials.jsonã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰**
   - ä½œæˆã•ã‚ŒãŸèªè¨¼æƒ…å ±ã®å³å´ã®ã€Œãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã€ã‚¢ã‚¤ã‚³ãƒ³ï¼ˆâ†“ï¼‰ã‚’ã‚¯ãƒªãƒƒã‚¯
   - ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã•ã‚ŒãŸJSONãƒ•ã‚¡ã‚¤ãƒ«ã‚’ `credentials.json` ã«ãƒªãƒãƒ¼ãƒ 
   - ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ«ãƒ¼ãƒˆã«é…ç½®

```bash
# ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ«ãƒ¼ãƒˆã«ã‚³ãƒ”ãƒ¼
mv ~/Downloads/client_secret_*.json /Users/r.umeyama/work/kickstarter-market-analyzer/credentials.json
```

### Step 4: ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã‚’æº–å‚™

1. **æ–°ã—ã„Googleã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã‚’ä½œæˆ**
   - https://sheets.google.com/ ã«ã‚¢ã‚¯ã‚»ã‚¹
   - ã€Œç©ºç™½ã€ã‚’ã‚¯ãƒªãƒƒã‚¯

2. **ã‚·ãƒ¼ãƒˆåã‚’è¨­å®š**
   - ã‚·ãƒ¼ãƒˆåï¼ˆä¸‹éƒ¨ã®ã‚¿ãƒ–ï¼‰: `kickstarter`

3. **åˆ—ã®ãƒ˜ãƒƒãƒ€ãƒ¼ã‚’è¨­å®š**

| A | B | C | D | E | F | G |
|---|---|---|---|---|---|---|
| ç•ªå· | Kickstarter URL | å•†å“å | ãƒ¡ãƒ¼ã‚«ãƒ¼å | ã‚¯ãƒªã‚¨ãƒ¼ã‚¿ãƒ¼å | æ—¥æœ¬èªãƒ¬ãƒãƒ¼ãƒˆ | è‹±èªãƒ¬ãƒãƒ¼ãƒˆ |

4. **ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆIDã‚’å–å¾—**
   - URLã‹ã‚‰å–å¾—: `https://docs.google.com/spreadsheets/d/{SPREADSHEET_ID}/edit`
   - `{SPREADSHEET_ID}` ã®éƒ¨åˆ†ã‚’ã‚³ãƒ”ãƒ¼

ä¾‹:
```
URL: https://docs.google.com/spreadsheets/d/1a2b3c4d5e6f7g8h9i0j/edit
SPREADSHEET_ID: 1a2b3c4d5e6f7g8h9i0j
```

5. **.envãƒ•ã‚¡ã‚¤ãƒ«ã«è¨­å®š**

```bash
# .envãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç·¨é›†
SPREADSHEET_ID=your_spreadsheet_id_here
SHEET_NAME=kickstarter
```

### Step 5: åˆå›èªè¨¼

1. **ãƒ†ã‚¹ãƒˆã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å®Ÿè¡Œ**

```bash
python sheets_client.py
```

2. **ãƒ–ãƒ©ã‚¦ã‚¶ã§èªè¨¼**
   - ãƒ–ãƒ©ã‚¦ã‚¶ãŒè‡ªå‹•çš„ã«é–‹ãã¾ã™
   - Googleã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§ãƒ­ã‚°ã‚¤ãƒ³
   - ã€Œã“ã®ã‚¢ãƒ—ãƒªã¯ Google ã§ç¢ºèªã•ã‚Œã¦ã„ã¾ã›ã‚“ã€ã¨è¡¨ç¤ºã•ã‚ŒãŸã‚‰:
     - ã€Œè©³ç´°ã€ã‚’ã‚¯ãƒªãƒƒã‚¯
     - ã€Œ[ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå]ï¼ˆå®‰å…¨ã§ã¯ãªã„ãƒšãƒ¼ã‚¸ï¼‰ã«ç§»å‹•ã€ã‚’ã‚¯ãƒªãƒƒã‚¯
   - ã€Œè¨±å¯ã€ã‚’ã‚¯ãƒªãƒƒã‚¯

3. **token.jsonãŒç”Ÿæˆã•ã‚Œã‚‹**
   - ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ«ãƒ¼ãƒˆã« `token.json` ãŒä½œæˆã•ã‚Œã¾ã™
   - ã“ã‚Œä»¥é™ã¯èªè¨¼ä¸è¦ã§ã™

## âœ… ç¢ºèª

ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã«ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’å…¥åŠ›:

| A | B | C | D | E | F | G |
|---|---|---|---|---|---|---|
| ç•ªå· | Kickstarter URL | å•†å“å | ãƒ¡ãƒ¼ã‚«ãƒ¼å | ã‚¯ãƒªã‚¨ãƒ¼ã‚¿ãƒ¼å | æ—¥æœ¬èªãƒ¬ãƒãƒ¼ãƒˆ | è‹±èªãƒ¬ãƒãƒ¼ãƒˆ |
| 1 | https://www.kickstarter.com/projects/beehivebooks/gulliver | Gulliver | Beehive Books | Beehive Team | | |

ãƒ†ã‚¹ãƒˆã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å®Ÿè¡Œ:

```bash
python sheets_client.py
```

å‡ºåŠ›ä¾‹:
```
=================================================================
Google Sheets API Test
============================================================
Spreadsheet ID: 1a2b3c4d5e6f7g8h9i0j
Sheet Name: kickstarter

Reading all rows...
âœ“ Found 2 rows

Finding unprocessed rows...
âœ“ Found 1 unprocessed rows

Row 2: https://www.kickstarter.com/projects/beehivebooks/gulliver

============================================================
```

## âš ï¸ ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ã‚¨ãƒ©ãƒ¼: `credentials.json not found`

- `credentials.json` ãŒãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ«ãƒ¼ãƒˆã«é…ç½®ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª
- ãƒ•ã‚¡ã‚¤ãƒ«åãŒæ­£ç¢ºã‹ç¢ºèªï¼ˆ`client_secret_xxx.json` ã§ã¯ãªã `credentials.json`ï¼‰

### ã‚¨ãƒ©ãƒ¼: `HttpError 403: Forbidden`

- Google Sheets APIãŒæœ‰åŠ¹åŒ–ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª
- ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆIDãŒæ­£ã—ã„ã‹ç¢ºèª
- OAuthåŒæ„ç”»é¢ã®ãƒ†ã‚¹ãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼ã«è‡ªåˆ†ã®ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ãŒè¿½åŠ ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª

### ã‚¨ãƒ©ãƒ¼: `HttpError 404: Not Found`

- ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆIDãŒæ­£ã—ã„ã‹ç¢ºèª
- ã‚·ãƒ¼ãƒˆåï¼ˆ`SHEET_NAME`ï¼‰ãŒæ­£ã—ã„ã‹ç¢ºèª

### ãƒ–ãƒ©ã‚¦ã‚¶ãŒé–‹ã‹ãªã„

```bash
# æ‰‹å‹•ã§èªè¨¼URLã‚’é–‹ã
python sheets_client.py
# è¡¨ç¤ºã•ã‚ŒãŸURLã‚’ãƒ–ãƒ©ã‚¦ã‚¶ã«ã‚³ãƒ”ãƒš
```

## ğŸ“š å‚è€ƒãƒªãƒ³ã‚¯

- [Google Sheets API Documentation](https://developers.google.com/sheets/api)
- [Python Quickstart](https://developers.google.com/sheets/api/quickstart/python)
- [OAuth 2.0](https://developers.google.com/identity/protocols/oauth2)
